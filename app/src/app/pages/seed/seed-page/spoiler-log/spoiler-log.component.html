<div class="input-label">
    <span class="settings-label">View: </span>
    <select [(ngModel)]="isSphereModeSelected">
        <option [ngValue]="false">Regions</option>
        <option [ngValue]="true">Item Spheres</option>
    </select>
</div>
        
<mat-tab-group *ngIf="!isSphereModeSelected" disablePagination="true" animationDuration="0">
    <mat-tab *ngFor="let spoilerArea of areas; let index = index" [label]="spoilerArea">
        <ng-template [ngTemplateOutlet]="searchContainer"></ng-template>
        <div class="right-container">
            <div class="table-container">
                <mat-table [dataSource]="spoilerLog[spoilerArea]">
                    <ng-container matColumnDef="location" >
                        <th mat-header-cell *matHeaderCellDef stic>Location</th>
                        <td mat-cell *matCellDef="let spoiler">{{spoiler.location}}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="item">
                        <th mat-header-cell *matHeaderCellDef>Item <mat-checkbox [(ngModel)]="hideItemNames">Hide Item names</mat-checkbox></th>
                        <td [ngClass]="{ 'hidden-items': hideItemNames}" mat-cell *matCellDef="let spoiler"><span>{{spoiler.item}}</span></td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="['location', 'item']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['location', 'item'];"></tr>
                </mat-table>
            </div>
        </div>
    </mat-tab>

    <mat-tab *ngIf="chapterDifficulties.length" [label]="'Chapter Difficulties'">
        <ng-template [ngTemplateOutlet]="searchContainer"></ng-template>
        <div class="right-container">
            <div class="table-container">
                <mat-table [dataSource]="chapterDifficulties">
                    <ng-container matColumnDef="chapter" >
                        <th mat-header-cell *matHeaderCellDef stic>Chapter</th>
                        <td mat-cell *matCellDef="let i=index">Chapter {{i + 1}}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="newDiff">
                        <th mat-header-cell *matHeaderCellDef>New Difficulty</th>
                        <td mat-cell *matCellDef="let chapterDiff"><span>{{chapterDiff}}</span></td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="['chapter', 'newDiff']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['chapter', 'newDiff'];"></tr>
                </mat-table>
            </div>
        </div>
    </mat-tab>
</mat-tab-group>

<mat-tab-group *ngIf="isSphereModeSelected" disablePagination="true" animationDuration="0">
    <mat-tab *ngFor="let sphere of sphereNames; let index = index" [label]="sphere">
        <ng-template [ngTemplateOutlet]="searchContainer"></ng-template>
        <div class="right-container">
            <div class="table-container">
                <mat-table [dataSource]="spheres[sphere]" *ngIf="spheres[sphere].length; else noSphereData">
                    <ng-container matColumnDef="region" >
                        <th mat-header-cell *matHeaderCellDef stic>Region</th>
                        <td mat-cell *matCellDef="let sphereEntry">{{sphereEntry.region}}</td>
                    </ng-container>
                    <ng-container matColumnDef="location" >
                        <th mat-header-cell *matHeaderCellDef stic>Location</th>
                        <td mat-cell *matCellDef="let sphereEntry">{{sphereEntry.location}}</td>
                    </ng-container>
                    
                    <ng-container matColumnDef="item">
                        <th mat-header-cell *matHeaderCellDef>Item <mat-checkbox [(ngModel)]="hideItemNames">Hide Item names</mat-checkbox></th>
                        <td [ngClass]="{ 'hidden-items': hideItemNames}" mat-cell *matCellDef="let sphereEntry"><span>{{sphereEntry.item}}</span></td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="['region', 'location', 'item']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['region', 'location', 'item'];"></tr>
                </mat-table>
            </div>
        </div>
    </mat-tab>
</mat-tab-group>

<ng-template #noSphereData>
    <p>This sphere has no item or partner that affects progression.</p>
</ng-template>

<ng-template #searchContainer>
    <div class="search-container">
        <h2>Item/Partner Search</h2>
        <input type="text"
                maxlength="30"
                placeholder="Item/Partner Name"
                [(ngModel)]="searchText"
                (ngModelChange)="filter()"
                matInput
                [matAutocomplete]="auto">
        <mat-autocomplete autoActiveFirstOption #auto="matAutocomplete"  (optionSelected)="onItemSearchChange()">
            <mat-option *ngFor="let item of filteredSearchItems" [value]="item">
            {{item}}
            </mat-option>
        </mat-autocomplete>
        <ng-container *ngIf="itemSearchresult ; else noResult">
            <p><span class="item-name">{{itemSearchresult}}</span> can be found at:</p>
            <p *ngFor="let location of locationSearchResults; let i=index">
                -<span class="location-name">{{locationSearchResults[i]}}</span>
                 within the <span class="area-name">{{areaSearchResults[i]}}</span> region</p>
        </ng-container>
        <ng-template #noResult>
            <p *ngIf="!filteredSearchItems.length && searchText?.length >= MIN_AMOUNT_OF_CHARS">There is no item with this name</p>
        </ng-template>
    </div>
</ng-template>